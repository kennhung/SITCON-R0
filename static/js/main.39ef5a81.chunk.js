(this["webpackJsonpsitcon-r0"]=this["webpackJsonpsitcon-r0"]||[]).push([[0],{28:function(e,t,a){e.exports=a(40)},33:function(e,t,a){},40:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(16),i=a.n(r),o=(a(33),a(18)),l=a(12),c=a(13),u=a(15),m=a.n(u),d=a(17),h=a(2),p=a(3),g=a(5),f=a(4),v=a(7),S=a(6),k=Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_IRC_NAME,y=null;function b(e){return e.edited_message||e.message}var E,T=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(g.a)(this,Object(f.a)(t).call(this,e))).retriveMessage=function(){null!==a.state.token&&function(e,t){return fetch("https://api.telegram.org/bot"+e+"/getUpdates?offset="+(t+1)).then((function(e){return e.json()}))}(a.state.token,a.state.latestUpdateId).then((function(e){if(a._ismounted){if(e.ok&&e.result){var t=localStorage.getItem("messages")?JSON.parse(localStorage.getItem("messages")):[],n=[].concat(Object(c.a)(t),Object(c.a)(e.result));a.state.IRC_id||n.forEach((function(e){if(!a.state.IRC_id){var t=b(e);t.chat.title===k&&(a.setState({IRC_id:t.chat.id}),localStorage.IRC_id=t.chat.id)}})),(n=(n=(n=n.filter((function(e){var t=b(e);return t&&t.chat&&t.chat.id===a.state.IRC_id}))).sort((function(e,t){var a=b(e),n=b(t);return void 0===a.edit_date&&(a.edit_date=1),void 0===n.edit_date&&(n.edit_date=1),a.message_id>n.message_id?1:a.message_id===n.message_id?a.edit_date>n.edit_date?1:a.edit_date===n.edit_date?0:-1:-1}))).map((function(e,t){var a=e.update_id,s=b(e);return t<n.findIndex((function(e){return b(e).message_id===s.message_id&&e.update_id!==a}))?null:e})).filter((function(e){return null!==e}))).length>=35&&(n=n.slice(5,n.length)),a.setState({latestUpdateId:e.result.length>0?Object(c.a)(e.result).pop().update_id:null,error:null}),a.saveMessage(n);var s=document.querySelector(".messages");s.scrollTop=s.scrollHeight}else a.setState({error:{message:e.error_code+": "+e.description}});y=setTimeout(a.retriveMessage,1e3)}}),(function(e){a.setState({error:e}),y=setTimeout(a.retriveMessage,1e3)}))},a.state={error:null,items:[],latestUpdateId:null,token:Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_TG_BOT_TOKEN?Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_TG_BOT_TOKEN:null,stickersPath:{},IRC_id:localStorage.IRC_id?JSON.parse(localStorage.IRC_id):null},a.clearSavedMsg=a.clearSavedMsg.bind(Object(v.a)(a)),a.saveMessage=a.saveMessage.bind(Object(v.a)(a)),a}return Object(S.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this;this._ismounted=!0,this.setState({items:localStorage.getItem("messages")?JSON.parse(localStorage.getItem("messages")):this.state.items}),this.retriveMessage(),document.addEventListener("keypress",(function(t){"c"===t.key&&(console.log("clear!"),e.clearSavedMsg())}))}},{key:"componentWillUnmount",value:function(){this._ismounted=!1,y&&(clearTimeout(y),y=null)}},{key:"getStickerWithFileId",value:function(e){var t=this;return new Promise((function(a,n){fetch("https://api.telegram.org/bot"+t.state.token+"/getFile?file_id="+e).then((function(e){return e.json()})).then((function(e){e.ok&&e.result?a("https://api.telegram.org/file/bot"+t.state.token+"/"+e.result.file_path):n(e)})).catch((function(e){return n(e)}))}))}},{key:"transferDate",value:function(e){var t=new Date(1e3*e);return t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0")}},{key:"msgTable",value:function(){var e=this,t=this.state.items,a=null;return s.a.createElement("div",{className:"messages"},t.map((function(t,n){var r=b(t);r.sticker&&r.sticker.file_id&&!e.state.stickersPath[r.sticker.file_id]&&e.getStickerWithFileId(r.sticker.is_animated?r.sticker.thumb.file_id:r.sticker.file_id).then((function(t){var a=e.state.stickersPath;a[r.sticker.file_id]=t,e.setState({stickersPath:a})}));var i=e.transferDate(r.date);return s.a.createElement("div",{key:n,className:"message"},i!==a&&(a=i)?s.a.createElement("div",{className:"time"},e.transferDate(r.date)):"",s.a.createElement("div",{className:"word"},r.from.username,": ",r.text?r.text.replace(/^<(.+)>/,"$1"):r.sticker?s.a.createElement("img",{width:"100px",src:e.state.stickersPath[r.sticker.file_id],alt:""}):s.a.createElement("strong",null,"[",["photo","audio","voice","document","video","video_note","contact","dice","game","poll","venue","location","invoice"].find((function(e){return!!r[e]})),"]")))})))}},{key:"saveMessage",value:function(e){localStorage.setItem("messages",JSON.stringify(e)),this.setState({items:e})}},{key:"clearSavedMsg",value:function(){this.saveMessage([])}},{key:"render",value:function(){return s.a.createElement("div",{className:"IRC"},this.msgTable())}}]),t}(n.Component),O=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(g.a)(this,Object(f.a)(t).call(this,e))).getTime=a.getTime.bind(Object(v.a)(a)),a.state={Time:"00:00"},a}return Object(S.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.getTime(),this.interval=setInterval(this.getTime,5e3)}},{key:"componentWillUnmount",value:function(){this.interval&&clearInterval(this.interval)}},{key:"agendaLoader",value:function(e){var t=e;return"object"===typeof e&&(t="".concat(e.startTime.hours.toString().padStart(2,"0"),":").concat(e.startTime.minutes.toString().padStart(2,"0"))+"~"+"".concat(e.endTime.hours.toString().padStart(2,"0"),":").concat(e.endTime.minutes.toString().padStart(2,"0"))+" "+"".concat(e.title)+(""===e.name||null===e.name?"":" by ".concat(e.name))),t}},{key:"getTime",value:function(){var e=new Date,t=e.getHours().toString().padStart(2,"0")+":"+e.getMinutes().toString().padStart(2,"0");this.setState({Time:t})}},{key:"render",value:function(){return"object"===typeof this.props.agenda?s.a.createElement("div",{className:"NowAgendaBar"},s.a.createElement("div",{className:"agenda"},s.a.createElement("div",{className:"agenda-time"},this.state.Time),s.a.createElement("div",{className:"agenda-title"},this.props.agenda.title),s.a.createElement("div",{className:"agenda-name"},this.props.agenda.name))):s.a.createElement("div",{className:"NowAgendaBar"},s.a.createElement("div",{className:"agenda"},s.a.createElement("div",{className:"agenda-time"},this.getTime()),s.a.createElement("div",{className:"agenda-title"},this.props.agenda)))}}]),t}(n.Component),_=function(e){function t(){return Object(h.a)(this,t),Object(g.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"MainDisplay"})}}]),t}(n.Component),N=function(e){function t(){return Object(h.a)(this,t),Object(g.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"BottomBar"})}}]),t}(n.Component),j=function(e){function t(){return Object(h.a)(this,t),Object(g.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.props.agenda.slido;return e?s.a.createElement("div",{className:"slido "+this.props.CSS_state},s.a.createElement("iframe",{title:"test",src:e.iframe,frameBorder:"0"})):s.a.createElement("div",{className:"slido-disabled"})}}]),t}(n.Component),C=function(e){function t(){return Object(h.a)(this,t),Object(g.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return"slido"===this.props.mode?s.a.createElement("div",{className:"SideBlock SideBlock-slido"}):s.a.createElement("div",{className:"SideBlock SideBlock-irc"})}}]),t}(n.Component),I=a(42),w=function(e){function t(){return Object(h.a)(this,t),Object(g.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"FlashCard"},this.props.forumSpeakers.map((function(t,a){return void 0!==t&&void 0!==e.props.nowForumSpeaker?s.a.createElement(I.a,{key:a,in:e.props.nowForumSpeaker.name===t.name,timeout:1e3,classNames:"speakers"},s.a.createElement("img",{src:"/img/".concat(t.url),alt:"",key:"img"+a,className:"".concat(e.props.nowForumSpeaker.name===t.name?"active":"")})):""})))}}]),t}(n.Component),B=0,P=1,L=2,M=3,A=[{title:"\u5165\u5834\u6642\u9593",name:"",startTime:{hours:8,minutes:30},endTime:{hours:9,minutes:0},slido:null,type:M},{title:"\u958b\u5e55",name:"",startTime:{hours:9,minutes:0},endTime:{hours:9,minutes:10},slido:null,type:B},{title:"\u6a5f\u5668\u5b78\u7fd2\u7684\u95dc\u9375\u4e0b\u4e00\u6b65",name:"\u674e\u5b8f\u6bc5",startTime:{hours:9,minutes:10},endTime:{hours:10,minutes:0},slido:{link:"https://sli.do/ozdireqh",iframe:"https://wall.sli.do/event/ozdireqh"},type:B},{title:"\u4f11\u606f\u6642\u9593",name:"",startTime:{hours:10,minutes:0},endTime:{hours:10,minutes:10},slido:null,type:M},{title:"\u99ed\u5165\u4e16\u754c\u6700\u6df1\u7684\u6d77\u6e9d",name:"CIH",startTime:{hours:10,minutes:10},endTime:{hours:11,minutes:0},slido:{link:"https://sli.do/uioorjnh",iframe:"https://wall.sli.do/event/uioorjnh"},type:B},{title:"\u4f11\u606f\u6642\u9593",name:"",startTime:{hours:11,minutes:0},endTime:{hours:11,minutes:10},slido:null,type:M},{title:"\u7b2c\u4e00\u6b21\u505a\u5bc6\u5ba4\u9003\u812b\u5c31\u4e0a\u624b",name:"\u6372\u6bdb",startTime:{hours:11,minutes:10},endTime:{hours:11,minutes:50},slido:{link:"https://sli.do/nnrswoh0",iframe:"https://wall.sli.do/event/nnrswoh0"},type:B},{title:"\u5348\u9910",name:"",startTime:{hours:11,minutes:50},endTime:{hours:12,minutes:40},slido:null,type:M},{title:"\u8ad6\u58c7 - \u522a\u4f60\u5ee2\u6587\u518d\u6536\u6389\u670d\u52d9\uff01\u5927\u578b\u8cc7\u8a0a\u4f01\u696d\u6c7a\u7b56\u7684\u81ea\u7531\u8207\u8cac\u4efb",name:"\u4e3b\u6301\u4eba - \u5b50\u9b5a\u3001\u8207\u8ac7\u4eba - \u4f55\u660e\u8ae0\u3001\u8207\u8ac7\u4eba - \u8a79\u5a77\u6021\u5f8b\u5e2b",startTime:{hours:12,minutes:40},endTime:{hours:14,minutes:10},slido:{link:"https://sli.do/dh59rkkn",iframe:"https://wall.sli.do/event/dh59rkkn"},type:P},{title:"\u4f11\u606f\u6642\u9593",name:"",startTime:{hours:14,minutes:10},endTime:{hours:14,minutes:20},slido:null,type:M},{title:"\u6211\u4e5f\u80fd\u8b93 Python \u5e6b\u5fd9\u64cd\u63a7\u96fb\u8166\u55ce\uff1f",name:"\u9673\u6021\u5347",startTime:{hours:14,minutes:20},endTime:{hours:14,minutes:30},slido:{link:"https://sli.do/8an7mvtb",iframe:"https://wall.sli.do/event/8an7mvtb"},type:B},{title:"\u63db\u5834",name:"",startTime:{hours:14,minutes:30},endTime:{hours:14,minutes:35},slido:null,type:M},{title:"\u81c9\u66f8\u8cc7\u6599\u63a2\u52d8\uff0d\u9bc9\u9b5a\u6559\u306e\u6559\u4e3b\u5d07\u62dc\u5206\u6790",name:"isekai",startTime:{hours:14,minutes:35},endTime:{hours:14,minutes:45},slido:{link:"https://sli.do/by45cctq",iframe:"https://wall.sli.do/event/by45cctq"},type:B},{title:"\u63db\u5834",name:"",startTime:{hours:14,minutes:45},endTime:{hours:14,minutes:50},slido:null,type:M},{title:"\u6c42\u8077\u52a9\u624b\u7684\u958b\u767c\u8d77\u6e90\u548c\u4ed6\u7684\u56f0\u96e3\u9ede",name:"\u767d\u5929\u7576Student",startTime:{hours:14,minutes:50},endTime:{hours:15,minutes:0},slido:{link:"https://sli.do/5opc27au",iframe:"https://wall.sli.do/event/5opc27au"},type:B},{title:"\u9ede\u5fc3",name:"",startTime:{hours:15,minutes:0},endTime:{hours:15,minutes:40},slido:null,type:M},{title:"\u5c31\u7b97\u662f\u65b0\u624b\uff0c\u6709\u611b\u5c31\u6c92\u628a\u5c08\u6848\u505a\u51fa\u4f86\uff0c\u5c0d\u5427",name:"\u5b8f\u5b8f",startTime:{hours:15,minutes:40},endTime:{hours:16,minutes:20},slido:{link:"https://sli.do/wu3rjw5r",iframe:"https://wall.sli.do/event/wu3rjw5r"},type:B},{title:"\u4f11\u606f\u6642\u9593",name:"",startTime:{hours:16,minutes:20},endTime:{hours:16,minutes:30},slido:null,type:M},{title:"CDN \u7db2\u7ad9\u653b\u64ca - \u9019\u6b21\u63db\u99ed\u5ba2\u7576\u9b3c\u4f86\u6293\u4f60\u4e86",name:"Mico",startTime:{hours:16,minutes:30},endTime:{hours:17,minutes:10},slido:{link:"https://sli.do/nbopftjl",iframe:"https://wall.sli.do/event/nbopftjl"},type:B},{title:"\u4f11\u606f\u6642\u9593",name:"",startTime:{hours:17,minutes:10},endTime:{hours:17,minutes:15},slido:null,type:M},{title:"Lightning Talk",name:"",startTime:{hours:17,minutes:15},endTime:{hours:17,minutes:40},slido:null,type:L},{title:"\u9589\u5e55",name:"",startTime:{hours:17,minutes:40},endTime:{hours:18,minutes:0},slido:null,type:B}],R=function(){var e=Object(d.a)(m.a.mark((function e(){var t,a,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://sitcon.org/2020/json/session.json",e.next=3,fetch("https://sitcon.org/2020/json/session.json");case 3:return t=e.sent,e.next=6,t.json();case 6:return a=e.sent,n=(n=a.sessions.filter((function(e){return"R0"===e.room})).map((function(e){var t=null,n=B;switch(e.zh.title.trim()){case"\u5165\u5834\u6642\u9593":case"\u4f11\u606f\u6642\u9593":case"\u63db\u5834":case"\u9ede\u5fc3":case"\u5348\u9910":n=M;break;case"\u8ad6\u58c7":n=P;break;case"Lightning Talk":n=L;break;default:n=B}if(e.qa){var s=e.qa.match(/([\w]+?)\/?$/)[1];t={link:e.qa,iframe:"https://wall.sli.do/event/"+s}}return{title:e.zh.title,name:e.speakers.map((function(e){return a.speakers.filter((function(t){return t.id===e}))[0].zh.name})).join("\u3001"),startTime:{hours:new Date(e.start).getHours(),minutes:new Date(e.start).getMinutes()},endTime:{hours:new Date(e.end).getHours(),minutes:new Date(e.end).getMinutes()},slido:t,type:n}}))).sort((function(e,t){return 60*e.startTime.hours+e.startTime.minutes-(60*t.startTime.hours+t.startTime.minutes)})),e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=a(19),D="\u4e00\u822c",U="\u8ad6\u58c7",F="Lighting Talk",J=(E={},Object(x.a)(E,B,{"PPT+SLIDO":{type:D,name:"PPT+SLIDO",prop:{main:"ppt",second:"slido"}},"PPT+IRC":{type:D,name:"PPT+IRC",prop:{main:"ppt",second:"irc"}},"SLIDO+IRC":{type:D,name:"SLIDO+IRC",prop:{main:"slido",second:"irc"}}}),Object(x.a)(E,P,{PPT:{type:U,name:"PPT",prop:{main:"ppt"}},SLIDO:{type:U,name:"SLIDO",prop:{main:"slido"}}}),Object(x.a)(E,L,{"PPT+IRC":{type:F,name:"PPT+IRC",prop:{main:"ppt",second:"irc"}},STBY:{type:F,name:"STBY",prop:{main:"visual",second:"irc"}},TIMEUP:{type:F,name:"TIMEUP",prop:{main:"ppt",second:"irc",timeUp:!0}}}),E),q=[{name:"\u8a79\u5a77\u6021",url:"r0/CARD_JAN.png"},{name:"\u4f55\u660e\u8ae0",url:"r0/CARD_HOU.png"},{name:"\u4e3b\u6301\u4eba",url:"r0/CARD_HOST.png"},{name:"EMPTY",url:"r0/CARD_EMPTY.png"}],H=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(g.a)(this,Object(f.a)(t).call(this,e))).state={error:null,items:[],latestUpdateId:null,token:Object({NODE_ENV:"production",PUBLIC_URL:"."}).TG_BOT_TOKEN?Object({NODE_ENV:"production",PUBLIC_URL:"."}).TG_BOT_TOKEN:null,inputToken:"",stickersPath:{},agenda:"",Agendas:A,nowForumSpeaker:{name:"Sharp",url:"1.png"}},a.tokenInputOnChange=a.tokenInputOnChange.bind(Object(v.a)(a)),a.saveToken=a.saveToken.bind(Object(v.a)(a)),a.clearSavedMsg=a.clearSavedMsg.bind(Object(v.a)(a)),a.saveMessage=a.saveMessage.bind(Object(v.a)(a)),a.nowPlaying=a.nowPlaying.bind(Object(v.a)(a)),a.changeSpeaker=a.changeSpeaker.bind(Object(v.a)(a)),a}return Object(S.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=Object(d.a)(m.a.mark((function e(){var t,a=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({items:localStorage.getItem("messages")?JSON.parse(localStorage.getItem("messages")):this.state.items,token:sessionStorage.getItem("bot_token")}),this.retriveMessage(),setInterval((function(){a.retriveMessage()}),5e3),setInterval(this.nowPlaying,1e3),e.next=6,R();case 6:(t=e.sent)&&this.setState({Agendas:t});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"nowPlaying",value:function(){var e=new Date,t=!0,a=!1,n=void 0;try{for(var s,r=this.state.Agendas[Symbol.iterator]();!(t=(s=r.next()).done);t=!0){var i=s.value;if(i.endTime.hours>e.getHours()||i.endTime.hours===e.getHours()&&i.endTime.minutes>e.getMinutes()){this.setState({agenda:i});break}}}catch(o){a=!0,n=o}finally{try{t||null==r.return||r.return()}finally{if(a)throw n}}}},{key:"retriveMessage",value:function(){var e=this;null!==this.state.token&&fetch("https://api.telegram.org/bot"+this.state.token+"/getUpdates?offset="+(this.state.latestUpdateId+1)).then((function(e){return e.json()})).then((function(t){if(t.ok&&t.result){var a=localStorage.getItem("messages")?JSON.parse(localStorage.getItem("messages")):[],n=[].concat(Object(c.a)(a),Object(c.a)(t.result));e.setState({latestUpdateId:t.result.length>0?Object(c.a)(t.result).pop().update_id:null,error:null}),e.saveMessage(n)}else e.setState({error:{message:t.error_code+": "+t.description}})}),(function(t){e.setState({error:t})}))}},{key:"getStickerWithFileId",value:function(e){var t=this;return new Promise((function(a,n){fetch("https://api.telegram.org/bot"+t.state.token+"/getFile?file_id="+e).then((function(e){return e.json()})).then((function(e){e.ok&&e.result?a("https://api.telegram.org/file/bot"+t.state.token+"/"+e.result.file_path):n(e)})).catch((function(e){return n(e)}))}))}},{key:"msgTable",value:function(){var e=this,t=this.state.items;return s.a.createElement("table",{style:{margin:"0 auto"}},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement("h5",null,"Message Id")),s.a.createElement("td",{style:{padding:"0 20px"}},s.a.createElement("h5",null,"Message")))),s.a.createElement("tbody",null,t.map((function(t,a){return t.message.sticker&&t.message.sticker.file_id&&!e.state.stickersPath[t.message.sticker.file_id]&&e.getStickerWithFileId(t.message.sticker.file_id).then((function(a){var n=e.state.stickersPath;n[t.message.sticker.file_id]=a,e.setState({stickersPath:n})})),s.a.createElement("tr",{key:a},s.a.createElement("td",null,t.message.message_id),s.a.createElement("td",{style:{padding:"0 20px"}},t.message.text?t.message.text:t.message.sticker?s.a.createElement("img",{width:"100px",height:"100px",src:e.state.stickersPath[t.message.sticker.file_id],alt:t.message.sticker.emoji}):s.a.createElement("strong",null,"Non Text or sticker")))}))))}},{key:"tokenInputOnChange",value:function(e){this.setState({inputToken:e.target.value})}},{key:"saveToken",value:function(){sessionStorage.setItem("bot_token",this.state.inputToken),console.log("new token saved"),this.setState({token:this.state.inputToken})}},{key:"saveMessage",value:function(e){localStorage.setItem("messages",JSON.stringify(e)),this.setState({items:e})}},{key:"clearSavedMsg",value:function(){this.saveMessage([])}},{key:"changeSpeaker",value:function(){var e=this,t=q.findIndex((function(t){return t.name===e.state.nowForumSpeaker.name}));t===q.length-1&&(t=-1),this.setState({nowForumSpeaker:q[t+1]})}},{key:"render",value:function(){var e=this.state.agenda?this.state.agenda:"SITCON \u5b78\u751f\u8a08\u7b97\u6a5f\u5e74\u6703";return s.a.createElement(o.a,null,s.a.createElement(l.c,null,s.a.createElement(l.a,{exact:!0,path:"/test"},s.a.createElement("div",{className:"test"},"Token: ",s.a.createElement("input",{onChange:this.tokenInputOnChange,value:this.state.inputToken}),s.a.createElement("button",{onClick:this.saveToken,style:{marginLeft:"10px"}},"Save Token"),s.a.createElement("button",{onClick:this.clearSavedMsg,style:{marginLeft:"10px"}},"Clear Message"),this.state.error?s.a.createElement("div",{style:{marginBottom:"10px"}},"Error: ",this.state.error.message):null,this.msgTable())),s.a.createElement(l.a,{path:"/test/IRC"},s.a.createElement("div",{className:"test-IRC"},s.a.createElement(T,null))),s.a.createElement(l.a,{path:"/test/NowAgendaBar"},s.a.createElement("div",{className:"test-NowAgendaBar"},s.a.createElement(O,{agenda:e}))),s.a.createElement(l.a,{path:"/test/MainDisplay"},s.a.createElement("div",{className:"test-MainDisplay"},s.a.createElement(_,null))),s.a.createElement(l.a,{path:"/test/ButtomBar"},s.a.createElement("div",{className:"test-ButtomBar"},s.a.createElement(N,null))),s.a.createElement(l.a,{path:"/test/Slido"},s.a.createElement("div",{className:"test-Slido"},s.a.createElement(j,{agenda:e}))),s.a.createElement(l.a,{path:"/test/FlashCard"},s.a.createElement("div",{className:"test-FlashCard"},s.a.createElement(w,{nowForumSpeaker:this.state.nowForumSpeaker,forumSpeakers:q}),s.a.createElement("button",{onClick:this.changeSpeaker},"Change!")))))}}]),t}(n.Component),W=function(e){function t(){return Object(h.a)(this,t),Object(g.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(p.a)(t,[{key:"getSlidoCSS",value:function(){return this.props.currentLayout.type===D?"slido"===this.props.currentLayout.prop.main?{main:"slido-on-main slido-on-main-fade-in",sidebar:"slido-on-sidebar slido-on-sidebar-fade-out"}:"slido"===this.props.currentLayout.prop.second?{main:"slido-on-main slido-on-main-fade-out",sidebar:"slido-on-sidebar slido-on-sidebar-fade-in"}:{main:"slido-on-main slido-on-main-fade-out",sidebar:"slido-on-sidebar slido-on-sidebar-fade-out"}:{main:"slido-on-main",sidebar:"slido-on-sidebar"}}},{key:"render",value:function(){var e=this.props.agenda?this.props.agenda:"SITCON \u5b78\u751f\u8a08\u7b97\u6a5f\u5e74\u6703";return this.props.currentLayout.type===D?s.a.createElement("div",{className:"R0page"},s.a.createElement("div",{className:"top-bar"},s.a.createElement(O,{agenda:e})),s.a.createElement("div",{className:"main"},s.a.createElement("div",{className:"main-display"},"visual"===this.props.currentLayout.prop.main?s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"visual"},s.a.createElement("img",{className:"lightningtalk",src:"/img/r0/lightningtalk.png",alt:"lightning talk"}))):s.a.createElement(_,{agenda:e}),s.a.createElement(j,{agenda:e,CSS_state:this.getSlidoCSS().main})),s.a.createElement("div",{className:"side-bar"},s.a.createElement("div",{className:"side-block"},s.a.createElement(C,{mode:this.props.currentLayout.prop.second})),s.a.createElement("div",{className:"side-content"},s.a.createElement(T,null),s.a.createElement(j,{agenda:e,CSS_state:this.getSlidoCSS().sidebar})))),s.a.createElement("div",{className:"bottom-bar"},s.a.createElement(N,null))):this.props.currentLayout.type===U?s.a.createElement("div",{className:"R0page"},s.a.createElement("div",{className:"top-bar"},s.a.createElement(O,{agenda:e})),s.a.createElement("div",{className:"main"},s.a.createElement("div",{className:"forum-slido "+("slido"===this.props.currentLayout.prop.main?"":"forum-slido-hidden")},s.a.createElement(j,{agenda:e,CSS_state:this.getSlidoCSS()})),s.a.createElement("div",{className:"forum-cam"},s.a.createElement(_,null)),s.a.createElement("div",{className:"forum-card"},s.a.createElement(w,{forumSpeakers:this.props.forumSpeakers,nowForumSpeaker:this.props.nowForumSpeaker}))),s.a.createElement("div",{className:"bottom-bar"},s.a.createElement(N,null))):this.props.currentLayout.type===F?s.a.createElement("div",{className:"R0page"},s.a.createElement("div",{className:"timesup "+(this.props.currentLayout.prop.timeUp?"":"timesup-hide")},s.a.createElement("h1",null,s.a.createElement("span",{className:this.props.currentLayout.prop.timeUp?"type":""},"ERROR: Connection Timed Out",s.a.createElement("span",{className:"caret"},"_")))),s.a.createElement("div",{className:"top-bar"},s.a.createElement(O,{agenda:e})),s.a.createElement("div",{className:"main"},s.a.createElement("div",{className:"main-display"},"visual"===this.props.currentLayout.prop.main?s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"visual"},s.a.createElement("img",{className:"lightningtalk",src:"/img/r0/lightningtalk.png",alt:"lightning talk"}))):s.a.createElement(_,{agenda:e}),s.a.createElement(j,{agenda:e,CSS_state:this.getSlidoCSS().main})),s.a.createElement("div",{className:"side-bar"},s.a.createElement("div",{className:"side-block"},s.a.createElement(C,{mode:this.props.currentLayout.prop.second})),s.a.createElement("div",{className:"side-content"},s.a.createElement(T,null),s.a.createElement(j,{agenda:e,CSS_state:this.getSlidoCSS().sidebar})))),s.a.createElement("div",{className:"bottom-bar"},s.a.createElement(N,null))):s.a.createElement("div",{className:"integrated"})}}]),t}(n.Component),V={ModeSelect:1},z=Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_CONTROL_BOT_TOKEN,K=Object({NODE_ENV:"production",PUBLIC_URL:"."}).REACT_APP_CONTROL_BOT_WHITELIST,Y={type:D,name:"EMPTY",prop:{}},G={name:"\u8a79\u5a77\u6021",url:"r0/CARD_JAN.png"},Q={title:"SITCON \u5b78\u751f\u8a08\u7b97\u6a5f\u5e74\u6703",name:"",startTime:{hours:8,minutes:30},endTime:{hours:9,minutes:0},slido:null,type:B},$=function(e){function t(e){var a;Object(h.a)(this,t),(a=Object(g.a)(this,Object(f.a)(t).call(this,e))).chatIds=[],a.getCurrentControlModes=function(){var e={};return a.state.agenda&&"object"===typeof a.state.agenda&&(e=J[a.state.agenda.type]),e};var n=Q;return localStorage.agenda&&(n=A[parseInt(localStorage.agenda)]?A[parseInt(localStorage.agenda)]:n),a.state={agenda:n,autoAgenda:!localStorage.autoAgenda||"true"===localStorage.autoAgenda,controlBotState:V.ModeSelect,currentLayout:localStorage.currentLayout?JSON.parse(localStorage.currentLayout):Y,nowForumSpeaker:localStorage.ForumSpeaker?JSON.parse(localStorage.ForumSpeaker):G,botId:localStorage.botId?JSON.parse(localStorage.botId):null},a.getAgendaByTime=a.getAgendaByTime.bind(Object(v.a)(a)),a.controlBotUpdate=a.controlBotUpdate.bind(Object(v.a)(a)),a.updateAgenda=a.updateAgenda.bind(Object(v.a)(a)),a.chatIds=localStorage.chatIds?JSON.parse(localStorage.chatIds):[],localStorage.autoAgenda=a.state.autoAgenda,a}return Object(S.a)(t,e),Object(p.a)(t,[{key:"getAgendaByTime",value:function(){var e=this,t=new Date,a=60*t.getHours()+t.getMinutes(),n=A.findIndex((function(e){var t=60*e.startTime.hours+e.startTime.minutes,n=60*e.endTime.hours+e.endTime.minutes;return t<=a&&a<n}));if(this.state.autoAgenda){for(;n>=0&&A[n].type===M;)n--;var s=n<0?Q:A[n];return this.state.botId&&s!==this.state.agenda&&setTimeout((function(){e.controlBotSend(e.state.botId)}),500),s}}},{key:"getDefaultLayout",value:function(e){var t=J[e.type];switch(e.type){case P:return t.PPT;default:return t["PPT+IRC"]}}},{key:"updateAgenda",value:function(e){var t=this.state.agenda;if(e&&e.callback_query){var a=e.callback_query.data;t=A[a]}else this.state.autoAgenda&&(t=this.getAgendaByTime());var n=this.state.currentLayout;J[t.type][n.name]||(n=this.getDefaultLayout(t)),this.setState({agenda:t,currentLayout:n})}},{key:"componentDidMount",value:function(){setInterval(this.updateAgenda,1e3),this.controlBotUpdate()}},{key:"controlBotSend",value:function(e,t,a){console.log("ControlBotSend!");var n=this.getCurrentControlModes(),s=[[]];Object.keys(n).map((function(e){return s[s.length-1].push({text:e})})),s.push([]),this.state.agenda&&this.state.agenda.type===P&&q.map((function(e,t,a){return s[s.length-1].push({text:e.name}),t===a.length-2&&s.push([]),0})),console.log(s),fetch("https://api.telegram.org/bot"+z+"/sendMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:e,text:t||(!1!==t?"\u6a21\u5f0f\uff1a"+(this.state.autoAgenda?"\u81ea\u52d5\uff08\u5207\u63db\u70ba\u624b\u52d5 /manual\uff09":"\u624b\u52d5\uff08\u5207\u63db\u70ba\u81ea\u52d5 /auto\uff09")+"\n\u7248\u578b\uff1a"+this.state.currentLayout.type+" > "+this.state.currentLayout.name+"\n\u8b70\u7a0b\uff1a"+(this.state.agenda&&this.state.agenda.title?this.state.agenda.title:this.state.agenda):null),reply_markup:a||(s.some((function(e){return e.length>0}))?{keyboard:s}:{remove_keyboard:!0})})})}},{key:"controlBotAnswerCallbackQuery",value:function(e,t){fetch("https://api.telegram.org/bot"+z+"/answerCallbackQuery",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({callback_query_id:e,text:t})})}},{key:"controlBotReceived",value:function(e){var t=this;if(e.message){if(console.log(e.message),console.log(K),console.log(e.message.from.username),!K.includes("@".concat(e.message.from.username)))return void console.log("@".concat(e.message.from.username," NOT CONTROLLER!!!"));if(-1===this.chatIds.findIndex((function(t){return t===e.message.chat.id}))&&this.chatIds.push(e.message.chat.id),this.setState({botId:e.message.chat.id}),0===e.message.text.search("/auto"))this.setState({autoAgenda:!0}),localStorage.autoAgenda="true",this.controlBotSend(e.message.chat.id,"\u5207\u63db\u70ba\u81ea\u52d5\u8b70\u7a0b"),setTimeout((function(){t.controlBotSend(e.message.chat.id)}),1e3);else if(0===e.message.text.search("/manual"))this.setState({autoAgenda:!1}),localStorage.autoAgenda="false",this.controlBotSend(e.message.chat.id,"\u5207\u63db\u70ba\u624b\u52d5\u8b70\u7a0b\n\u9078\u64c7\u8b70\u7a0b /set");else if(0===e.message.text.search("/set")){var a=[],n=0,s=0;A.forEach((function(e,t){e.type!==M&&(a[s]||(a[s]=[]),a[s].push({text:e.title,callback_data:t}),++n>=2&&(n=0,s++))})),this.controlBotSend(e.message.chat.id,"\u8acb\u5728\u4e0b\u65b9\u9078\u64c7\u8b70\u7a0b",{inline_keyboard:a})}else if(0===e.message.text.search("/cancel"))this.setState({controlBotState:V.ModeSelect}),this.controlBotSend(e.message.chat.id,"\u5df2\u53d6\u6d88\u52d5\u4f5c");else if(this.state.controlBotState===V.ModeSelect){var r=!0;console.log(r),console.log(q,e.message);var i=this.getCurrentControlModes();if(void 0!==i[e.message.text])this.setState({currentLayout:i[e.message.text]});else if(this.state.agenda.type===P){var o=q.findIndex((function(t){return t.name===e.message.text}));o>=0?this.setState({nowForumSpeaker:q[o]}):r=!1}else r=!1;r?(localStorage.currentLayout=JSON.stringify(this.state.currentLayout),this.controlBotSend(e.message.chat.id,null)):this.controlBotSend(e.message.chat.id,"\u7121\u6548\u7684\u6a21\u5f0f")}}else if(e.callback_query){var l=e.callback_query,c=l.data;this.updateAgenda(e),this.setState({autoAgenda:!1,controlBotState:V.ModeSelect}),this.chatIds.forEach((function(e){t.controlBotSend(e)})),localStorage.agenda=c,localStorage.autoAgenda="false",this.controlBotAnswerCallbackQuery(l.id,"\u8b70\u7a0b\u8a2d\u5b9a\u70ba\uff1a"+A[c].title)}}},{key:"controlBotUpdate",value:function(){var e=this;fetch("https://api.telegram.org/bot"+z+"/getUpdates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({offset:+localStorage.control_offset+1,timeout:60})}).then((function(e){return e.json()})).then((function(t){t.ok&&t.result.forEach((function(t){localStorage.control_offset=t.update_id,e.controlBotReceived(t),e.updateAgenda(t)})),setTimeout((function(){e.controlBotUpdate()}),100)}),(function(t){e.setState({error:t}),setTimeout((function(){e.controlBotUpdate()}),100)}))}},{key:"render",value:function(){return s.a.createElement(W,{currentLayout:this.state.currentLayout,autoAgenda:this.state.autoAgenda,agenda:this.state.agenda,forumSpeakers:q,nowForumSpeaker:this.state.nowForumSpeaker})}}]),t}(n.Component);var X=function(){return s.a.createElement("div",{className:"App"},s.a.createElement(o.a,null,s.a.createElement(l.c,null,s.a.createElement(l.a,{exact:!0,path:"/"},s.a.createElement($,null)),s.a.createElement(l.a,{path:"/test"},s.a.createElement(H,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(s.a.createElement(X,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[28,1,2]]]);
//# sourceMappingURL=main.39ef5a81.chunk.js.map